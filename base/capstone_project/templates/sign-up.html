{% extends 'base.html' %}
{% load static %}

{% block title %}
Knights of Columbus - Sign Up
{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/signup-style.css' %}?v={% now 'U' %}">
<div class="container">
    <h1>Create an Account</h1>
    <section class="sign-up-form">
        <h2>Create an Account</h2>
        {% if error %}
            <p class="message error-message">{{ error }}</p>
        {% endif %}
        {% if success %}
            <p class="message success-message">{{ success }}</p>
        {% endif %}
        <form method="post" id="signupForm" onsubmit="return validateForm()">
            {% csrf_token %}
            <label for="full_name">Full Name:</label>
            <input type="text" id="full_name" name="full_name" placeholder="Enter your full name" required>
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" placeholder="Choose your username" required>
            <label for="email">Email Address:</label>
            <input type="email" id="email" name="email" placeholder="Enter your email address" required>
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" placeholder="Enter your password" required>
            <label for="re_password">Re-enter Password:</label>
            <input type="password" id="re_password" name="re_password" placeholder="Re-enter your password" required>
            <label for="birthday">Birthday:</label>
            <input type="date" id="birthday" name="birthday" required>
            <label for="address">Address:</label>
            <input type="text" id="address" name="address" placeholder="Enter your address">
            <label for="contact_number">Contact Number:</label>
            <input type="text" id="contact_number" name="contact_number" placeholder="Enter your contact number" maxlength="15">
            <label>Select Your Council:</label>
            <select name="council" required>
                <option value="" disabled selected>Select a council</option>
                {% for council in councils %}
                    <option value="{{ council.id }}">{{ council.name }}</option>
                {% endfor %}
            </select>
            <button type="submit">Create Account</button>
        </form>
        <p>Already have an account? <a href="{% url 'sign-in' %}" style="color: #003087; text-decoration: underline;">Sign in</a>.</p>
    </section>
</div>

<style>
    .message {
        font-size: 16px;
        padding: 10px;
        margin-bottom: 15px;
        border-radius: 5px;
        text-align: center;
    }
    .success-message {
        color: #155724;
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
    }
    .error-message {
        color: #721c24;
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
    }
    textarea {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        resize: vertical;
    }
</style>

<script>
    function validateForm() {
        const password = document.getElementById('password').value;
        const rePassword = document.getElementById('re_password').value;
        const birthday = document.getElementById('birthday').value;
        if (password !== rePassword) {
            alert('Passwords do not match. Please try again.');
            return false;
        }
        if (birthday) {
            const birthDate = new Date(birthday);
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            if (age < 18) {
                alert('You must be at least 18 years old to sign up.');
                return false;
            }
        }
        return true;
    }
</script>
{% endblock %}